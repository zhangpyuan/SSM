var _is_finisj_follow_each_other_flag_ = true;
function follow_each_batch_bt_click() {
    if (_is_finisj_follow_each_other_flag_ == false) {
        return;
    }
    var selectedCount = $(":input[name='selectedFollowers']").length;
    if (selectedCount > 0) {
        var selectedUids = "";
        $(":input[name='selectedFollowers']").each(function() {
            selectedUids += $(this).val() + ",";
        });
        selectedUids = selectedUids.substring(0, selectedUids.length - 1);
        alertTip("正在互粉，可能需要一会儿哦，请稍后...", 4);
        _is_finisj_follow_each_other_flag_ = false;
        var url = "batchFollowUser.htm?isEachOther=true&targetUids=" + selectedUids;
        $.get(url,
        function(data) {
            _is_finisj_follow_each_other_flag_ = true;
            removeTip();
            if (data) {
                var successNumber = 0;
                var failNumber = 0;
                var dataArray = data.split(",");
                var targetUids = "";
                for (var i = 0; i < dataArray.length; i++) {
                    if (dataArray[i] != "") {
                        if (dataArray[i].split("-")[1] == "true") {
                            successNumber++;
                            remove_show(dataArray[i].split("-")[0]);
                            targetUids += dataArray[i].split("-")[0] + ",";
                        } else {
                            failNumber++;
                        }
                    }
                }
                if (failNumber == 0) {
                    alertTip("成功互粉" + successNumber + "人！", 1);
                    setTimeout(function() {
                        follow_go_page(1);
                    },
                    1800);
                } else {
                    alertTip("成功互粉" + successNumber + "人，失败" + failNumber + "个!", 2);
                }
                if (targetUids != "") {
                    alyCms.follow.validateUserFollowedStatus(targetUids);
                }
            }
        });
    } else {
        alertTip("请选择你要互粉的用户！", 2);
    }
}
function follow__each_bt_click(uid, userId) {
    setTimeout(function() {
        $('#follow_selected_bt_' + uid).click();
    },
    10);
    if (_is_finisj_follow_each_other_flag_ == false) {
        return;
    }
    _is_finisj_follow_each_other_flag_ = false;
    alertTip("正在互粉，请稍后...", 4);
    var url = "followSomeone.htm?isEachOther=true&targetUid=" + uid + "&targetUserId=" + userId;
    $.get(url,
    function(data) {
        _is_finisj_follow_each_other_flag_ = true;
        removeTip();
        if (data == "-1") {
            alertTip("不能互粉自己！", 3);
        }
        if (data == "1") {
            alertTip("互粉失败，您的粉币不够哦！", 3);
        }
        if (data == "2") {
            alertTip("互粉失败，该用户粉币不够！", 3);
        }
        if (data == "3") {
            alertTip("互粉失败，该用户已经关闭互粉！", 3);
            remove_show(uid);
        }
        if (data == "4") {
            alertTip("互粉失败，对方互粉已达上限！", 3);
            remove_show(uid);
        }
        if (data == "5") {
            alertTip("互粉失败，您不符合对方设置的互粉条件！", 3);
            remove_show(uid);
        }
//        if (data == "100") {
//            var maxOneHour = $("#maxFollowRepostOneHour").val();
//            alertTip("互粉失败，一小时内最多可关注" + maxOneHour + "人，你已经超过限制，再等一会儿吧！", 3);
//        }
//        if (data == "101") {
//            var maxFollowRepostOneDay = $("#maxFollowRepostOneDay").val();
//            alertTip("互粉失败，一天内最多可关注" + maxFollowRepostOneDay + "人，你已经超过限制，明天再来吧！", 3);
//        }
        if (data == "0") {
            alyCms.follow.validateUserFollowedStatus(uid);
            alertTip("互粉成功！", 1);
            remove_show(uid);
        }
        if (data.indexOf("fail") > -1) {
            var errorText = data.substring(5, data.length);
            var text = errorText.split("---")[0];
            var type = errorText.split("---")[1];
            if (type == "1") {
                if (errorText.indexOf("关注过此用户") > -1) {
                    alertTip("互粉失败，你已经过此用户了", 3);
                    remove_show(uid);
                } else {
                    alertTip("互粉失败，您的帐号异常，" + text, 3);
                }
            } else if (type == "2") {
                if (errorText.indexOf("关注过此用户") > -1) {
                    alertTip("互粉失败，该用户已经关注过你了", 3);
                    remove_show(uid);
                } else if (errorText.indexOf("已经被封号") > -1) {
                    alertTip("互粉失败，该用户已经被封号！", 3);
                    remove_show(uid);
                } else if (errorText.indexOf("授权已经过期") > -1) {
                    alertTip("互粉失败，该用户帐号授权已经过期！", 3);
                    remove_show(uid);
                } else if (errorText.indexOf("超过了限制") > -1) {
                    alertTip("互粉失败，该用户关注的数量超过了限制！", 3);
                    remove_show(uid);
                } else {
                    alertTip("互粉失败，该用户的帐号异常，" + text, 3);
                }
            } else {
                alertTip("互粉失败，" + text, 3);
            }
        }
    });
}
function remove_show(uid) {
    $("#li_" + uid).fadeOut(400,
    function() {
        $("#li_" + uid).remove();
    });
}
$(function() {
    $("a[name='_checkbox_selectedFollowers']").each(function() {
        $(this).click();
    });
});